#!/usr/bin/python
import boto
from boto.s3.key import Key
import hashlib
import magic
import gzip
import sys

unique_string = 'ADD_YOUR_UNIQUE_STRING_HERE'

if len(sys.argv) > 1:
    arg = sys.argv[1]
else:
    print 'Usage: ./malware_s3_upload <filename>\n'
    sys.exit()

# get magic value
fm = magic.from_file(arg)
print fm

# Get hash digests
testFile = open(arg, "rb")
md5 = hashlib.md5(arg)
md5 = md5.hexdigest()
sha256 = hashlib.sha256(arg)
sha256 = sha256.hexdigest()

# Connect and upload to S3 bucket
conn = boto.connect_s3()
bucket = conn.create_bucket(unique_string.lower()+'_malware')
k = Key(bucket)
# Set unique_id
k.key = sha256
k.set_metadata('md5_hash', md5)
k.set_metadata('file_type', fm)
k.set_contents_from_filename(arg)

